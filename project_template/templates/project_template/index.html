<html>
    <head>
        <link rel="stylesheet" href="/static/bootstrap.min.css">
        <link rel="stylesheet" href="/static/main.css">
        <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
        <script type="text/javascript" src="/static/jquery.min.js"></script>
    </head>
    
    <body>
        <div class="top-banner">
            <h1 class="project-name">
                NBA Draft
                <font color="#ED174B">Prediction</font>
            </h1>
            <br>
            <h6 class="team-members">Eric Ma (exm2), Jason Liao (jtl93), Nikita Dubnov (nd296), Trevor McDonald (tdm67)</h6>
        </div>
        
        
        <form class="form-inline global-search" method='GET'>
            <h4><b>Select tags and enter a text query to describe a certain prospect in the 2017 NBA Draft.</b></h4>
            <br><br>
            <div class="tag-word-area">
                <span class="tag-word" id="shooter" onclick="select_tag(event)"><h5>Shooter</h5></span>
                <span class="tag-word" id="scorer" onclick="select_tag(event)"><h5>Scorer</h5></span>
                <span class="tag-word" id="driver" onclick="select_tag(event)"><h5>Driver</h5></span>
                <span class="tag-word" id="dunker" onclick="select_tag(event)"><h5>Dunker</h5></span>
                <span class="tag-word" id="passer" onclick="select_tag(event)"><h5>Passer</h5></span>
                <span class="tag-word" id="rebounder" onclick="select_tag(event)"><h5>Rebounder</h5></span>
                <span class="tag-word" id="defender" onclick="select_tag(event)"><h5>Defender</h5></span>
                <span class="tag-word" id="bigman" onclick="select_tag(event)"><h5>Big Man</h5></span>
                <span class="tag-word" id="physicality" onclick="select_tag(event)"><h5>Physicality</h5></span>
                <span class="tag-word" id="shotblocker" onclick="select_tag(event)"><h5>Shot Blocker</h5></span>
                <span class="tag-word" id="athletic" onclick="select_tag(event)"><h5>Athletic</h5></span>
                <span class="tag-word" id="quick" onclick="select_tag(event)"><h5>Quick</h5></span>
                <span class="tag-word" id="leader" onclick="select_tag(event)"><h5>Leader</h5></span>
                <span class="tag-word" id="length" onclick="select_tag(event)"><h5>Length</h5></span>
                <span class="tag-word" id="smart" onclick="select_tag(event)"><h5>Smart</h5></span>
                <span class="tag-word" id="skillful" onclick="select_tag(event)"><h5>Skillful</h5></span>
                <span class="tag-word" id="flashy" onclick="select_tag(event)"><h5>Flashy</h5></span>
                <span class="tag-word" id="potential" onclick="select_tag(event)"><h5>Potential</h5></span>
            </div>
            <br><br>
            
            <div class="form-group">
                <input id="input" type="text" name="search" class="form-control" oninput="checkText(event)" placeholder="Describe a player">
                <select name="positions" class="position-selector">
                    <option value="any">Any Position</option>
                    <option value="pg">Point Guard</option>
                    <option value="sg">Shooting Guard</option>
                    <option value="sf">Small Forward</option>
                    <option value="pf">Power Forward</option>
                    <option value="c">Center</option>
                </select>
                <select id="version-selection" name="version" class="position-selector">
                    <option value="2">Second Prototype</option>
                    <option value="1">First Prototype</option>
                </select>
              </div>
            <button type="submit" class="btn btn-info"> Find Players! </button>
        </form>
        
        <div class="form-inline global-search">
            <h4>{{pos}}</h4><br>
            <h5>Current Search: <i>{{search}}</i></h5><br><br>
            <h4 id="click-on-red">Click on red player card to show quotes:</h4>
            <br>
            {% for line in output %}
                <div class="player-row" onclick="expandPlayer(event)" id="{{forloop.counter}}">
                    <div class="player-row-image">
                        <img src="/static/images/player_images/{{line.3}}" class="result-image" >
                    </div>
                    <div class="player-row-content">
                        <h3>{{line.6}}{{line.0}}</h3>
                        <br>
                        <h5>{{line.4}}</h5>
                        <br>
                        Query Score: {{line.1}}
                        <br>
                        <h5><b>Similar NBA Players:</b></h5>
                        <br>
                        {% for simplayer in line.2 %}
                            {{simplayer.0}} - {{simplayer.1}}
                            <br>
                        {% endfor %}
                    </div>
                </div>
                <br>
                <div class="quote-row" id="quote-{{forloop.counter}}">
                    {% for quote in line.5 %}
                        <h5>"{{quote}}"</h5>
                        <br>
                    {% endfor %}
                </div>
            {% endfor %}
            <br>
        </div>
        <img class="footer-image" src="/static/images/footer_image.jpg">
    </body>

    <script type="text/javascript">
    function select_tag(event) {
        var selectedClass = event["path"][1]["className"];
        var selectedText = event["path"][1]["innerText"].toLowerCase();
        var thisId = event["path"][1]["id"];
        if (selectedClass == "tag-word") {
            $("#" + thisId).css("background-color", "#31B0D5");
            $("#" + thisId).css("color", "white");
            $("#" + thisId).attr('class', 'tag-selected');
            if ($("#input").val() == "") {
                $("#input").val($("#input").val() + selectedText);
            }
            else {
                $("#input").val($("#input").val() + " " + selectedText);
            }
        } else if (selectedClass == "tag-selected") {
            var inputTokens = $("#input").val().split(" ")
            if (inputTokens[0] == selectedText) {
                $("#input").val($("#input").val().replace(selectedText, ""));
                $("#" + thisId).css("background-color", "white");
                $("#" + thisId).css("color", "black");
                $("#" + thisId).attr('class', 'tag-word');
            } else {
                $("#input").val($("#input").val().replace(" " + selectedText, ""));
                $("#" + thisId).css("background-color", "white");
                $("#" + thisId).css("color", "black");
                $("#" + thisId).attr('class', 'tag-word');
            }
        }
    };

    function checkText(event) {
        var inputText = $("#input").val();
        var tokenListLarge = inputText.split(" ");
        // Make all tokens lowercase
        var tokenList = []
        for (var i = 0; i < tokenListLarge.length; i++) {
            tokenList.push(tokenListLarge[i].toLowerCase());
        }
        // Account for "shot blocker" label
        if (tokenList.indexOf("shot") >= 0) {
            var shotIndex = tokenList.indexOf("shot");
            if (tokenList[shotIndex + 1] == "blocker") {
                tokenList.push("shot blocker");
            }
        }
        // Account for "big man" label
        if (tokenList.indexOf("big") >= 0) {
            var shotIndex = tokenList.indexOf("big");
            if (tokenList[shotIndex + 1] == "man") {
                tokenList.push("big man");
            }
        }
        var labelList = ["shooter", "scorer", "driver", "dunker", "passer", "rebounder", "defender", "big man", "physicality", "shot blocker", "athletic", "quick", "leader", "length", "smart", "skillful", "flashy", "potential"];
        for (token in tokenList) {
            var smallToken = tokenList[token].toLowerCase();
            if (labelList.indexOf(smallToken) >= 0) {
                var thisIndex = labelList.indexOf(smallToken);
                var thisLabel = labelList[thisIndex];
                if (thisLabel == "shot blocker" || thisLabel == "big man") {
                    thisLabel = thisLabel.replace(" ", "")
                }
                $("#" + thisLabel).attr('class', 'tag-selected');
                $("#" + thisLabel).css("background-color", "#31B0D5");
                $("#" + thisLabel).css("color", "white");
            } 
        }
        var selectedList = [];
        $(".tag-selected").each(function(i, obj) {
            selectedList.push(obj["id"]);
        })
        for (s_item in selectedList) {
            var checkId = selectedList[s_item];
            if (inputText.includes(checkId)) {
                continue;
            }
            else {
                if (checkId == "shot blocker" || checkId == "big man") {
                    checkId = checkId.replace(" ", "")
                }
                $("#" + checkId).attr('class', 'tag-word');
                $("#" + checkId).css("background-color", "white");
                $("#" + checkId).css("color", "black");
            }
        }
    };

    function expandPlayer(event) {
        var id = event["path"][1]["id"];
        var currentDisplay = $("#quote-" + id).css("display");
        if (currentDisplay == "none") {
            $("#quote-" + id).css("display","inline-block");
        } else {
            $("#quote-" + id).css("display","none");
        }
        
    }

    // Change what is seen with version change
    $("#version-selection").change(function() {
        var version = $("#version-selection").val();
        console.log(version)
        if (version == "1") {
            $(".tag-word-area").hide();
            $("#click-on-red").hide();

        } else if (version == "2") {
            $(".tag-word-area").show();
            $("#click-on-red").show();
        }
    })

    </script>

</html>